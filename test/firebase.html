<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Firebase Tests</title>
		<link
			rel="stylesheet"
			href="https://get.mavo.io/mavo.css"
		/>
		<link rel="stylesheet" href="style.css" />
		<script src="https://get.mavo.io/mavo.js"></script>
		<script src="test.js"></script>
		<script src="../src/mavo-firebase-firestore.js"></script>
		<style>
			[data-test^="test"] td + td {
				white-space: pre-line;
			}

			[data-test^="test"] td:first-of-type,
			[data-test^="test"] th:first-of-type {
				word-wrap: break-word;
				flex: none;
				width: 20%;
			}
		</style>
	</head>
	<body>
		<h1>Firebase Tests</h1>

		<section>
			<h1>parseSource</h1>

			<table class="reftest" data-test="testParseSource" data-columns="3">
				<tr>
					<td>mavo-demos</td>
					<td>{
							projectId: "mavo-demos",
							collection: "mavo-apps",
							filename: "countries",
							databaseURL: "https://mavo-demos.firebaseio.com"
						}
					</td>
				</tr>

				<tr>
					<td>d12n/mv-app/people</td>
					<td>{
						projectId: "d12n",
						filename: "people",
						collection: "mv-app",
						databaseURL: "https://d12n.firebaseio.com"
					}
					</td>
				</tr>

				<tr>
					<td>mavo-demos/mv-app/collection/subcollection/people</td>
					<td>{
						projectId: "mavo-demos",
						filename: "people",
						collection: "mv-app/collection/subcollection",
						databaseURL: "https://mavo-demos.firebaseio.com"
					}
					</td>
				</tr>
			</table>

			<script>
				function testParseSource(test, result, expected) {
					try {
						const r = Mavo.Backend.Firebase.parseSource(test.textContent, {
							collection: "mavo-apps",
							filename: "countries"
						});
						result.textContent = Mavo.toJSON(r);

						eval("var exp = " + expected.textContent);
						return Test.equals(r, exp);
					} catch (e) {
						console.error(e);
						result.textContent = "ERROR";
						return false;
					}
				}
			</script>
		</section>

		<section>
			<h1>getOptions</h1>

			<table class="reftest" data-test="testGetOptions" data-columns="3">
				<thead>
					<th>mv-firebase value</th>
					<th>Actual features</th>
					<th>Expected features</th>
				</thead>
				<tr title="Default">
					<td>&nbsp;</td>
					<td>{ auth: false, storage: false, realtime: false }</td>
				</tr>

				<tr title="Absolute">
					<td>auth realtime storage</td>
					<td>{ auth: true, storage: true, realtime: true }</td>
				</tr>

				<tr title="Absolute with duplicates">
					<td>auth auth auth storage storage</td>
					<td>{ auth: true, storage: true, realtime: false }</td>
				</tr>

				<tr title="Ignore nonexistent features">
					<td>realtime foo storage</td>
					<td>{ auth: false, storage: true, realtime: true }</td>
				</tr>
			</table>

			<script>
				function testGetOptions(test, result, expected) {
					try {
						const r = Mavo.Backend.Firebase.getOptions(test.textContent, {
							auth: false,
							storage: false,
							realtime: false
						});
						result.textContent = Mavo.toJSON(r);

						eval("var exp = " + expected.textContent);
						return Test.equals(r, exp);
					} catch (e) {
						console.error(e);
						result.textContent = "ERROR";
						return false;
					}
				}
			</script>
		</section>

		<section
			mv-app="firebasetest"
			mv-storage="mavo-demos/mavo-apps/countries"
		>
			<h1>Basic</h1>

			<table class="reftest">
				<tr>
					<td>
						<ul>
							<li property="country" mv-multiple>
								<span property="code">Code</span>
								<span property="name">Name</span>
							</li>
						</ul>
					</td>
					<td>
						<ul>
							<li>Online</li>
							<li>us United States</li>
							<li>gb United Kingdom</li>
						</ul>
					</td>
				</tr>
			</table>
		</section>

		<section
			mv-app="dynamic"
			mv-storage="mavo-demos/mavo-apps/[flip? 'countries' : 'people']"
		>
			<h1>Dynamic</h1>

			<p><input type="checkbox" property="flip" /> Check me</p>

			<table class="reftest">
				<tr>
					<td>
						<ul>
							<li property="country" mv-multiple>
								<span property="code">Code</span>
								<span property="name">Name</span>
							</li>
						</ul>
					</td>
					<td>
						<ul>
							<li>Online</li>
							<li>us United States</li>
							<li>gb United Kingdom</li>
						</ul>
					</td>
				</tr>
			</table>
		</section>

		<section
			mv-app="firebaseupload"
			mv-storage="mavo-demos/mavo-apps/countries"
			mv-firebase="auth storage"
		>
			<h1>Firebase upload</h1>

			<p>
				Try to upload an image below. Try pasting an image, or drag & drop too.
			</p>
			<img
				property="image"
				src="https://mavo.io/logo.svg"
				style="max-width: 100%"
			/>
		</section>

		<section mv-app="urltest" mv-storage="">
			<h1>mv-storage=Firebase, mv-source=Element, via URL</h1>

			<p>
				<a
					href="?urltest-storage=mavo-demos/mavo-apps/countries&urltest-source=%23countries"
					>Click here first for this test to pass.</a
				>
			</p>
			<table class="reftest">
				<tr class="interactive">
					<td>
						<ul>
							<li property="country" mv-multiple>
								<span property="code">Code</span>
								<span property="name">Name</span>
							</li>
						</ul>
					</td>
					<td>
						<ul>
							<li>us United States</li>
							<li>jp Japan</li>
							<li>es Spain</li>
						</ul>
					</td>
				</tr>
			</table>
		</section>

		<section
			mv-app
			mv-storage="mavo-demos/mavo-apps/countries"
			mv-source="#countries"
		>
			<h1>mv-storage=Firebase, mv-source=element</h1>

			<table class="reftest">
				<tr>
					<td>
						<ul>
							<li property="country" mv-multiple>
								<span property="code">Code</span>
								<span property="name">Name</span>
							</li>
						</ul>
					</td>
					<td>
						<ul>
							<li>us United States</li>
							<li>jp Japan</li>
							<li>es Spain</li>
						</ul>
					</td>
				</tr>
			</table>
		</section>

		<section mv-app mv-source="mavo-demos/mavo-apps/countries">
			<h1>No storage, mv-source=Firebase</h1>
			<p>Should display data but no editing controls</p>

			<table class="reftest">
				<tr>
					<td>
						<ul>
							<li property="country" mv-multiple>
								<span property="code">Code</span>
								<span property="name">Name</span>
							</li>
						</ul>
					</td>
					<td>
						<ul>
							<li>Online</li>
							<li>us United States</li>
							<li>gb United Kingdom</li>
						</ul>
					</td>
				</tr>
			</table>
		</section>

		<script type="application/json" id="countries">
			{
				"country": [
					{
						"code": "us",
						"name": "United States"
					},
					{
						"code": "jp",
						"name": "Japan"
					},
					{
						"code": "es",
						"name": "Spain"
					}
				]
			}
		</script>

		<script>
			$$("[mv-app]").forEach(section =>
				section.setAttribute(
					"mv-firebase-key",
					"AIzaSyDvZ3EBuhlvFm529vMPeU7dbqvdkjv9WQU"
				)
			);
		</script>
	</body>
</html>
